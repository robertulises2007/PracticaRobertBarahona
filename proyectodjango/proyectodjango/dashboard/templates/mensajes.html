{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="flex flex-col h-[80vh] max-w-3xl mx-auto bg-white rounded-2xl shadow-lg">
    
    <!-- Header -->
    <div class="flex items-center bg-blue-600 text-white px-4 py-3 rounded-t-2xl">
        <div class="flex-1">
            <h2 class="text-lg font-semibold">{{ conversacion.contacto.nombre }}</h2>
            <p class="text-sm text-blue-100">Conversación #{{ conversacion.id }}</p>
        </div>
        <a href="{% url 'conversaciones_list' %}" class="text-sm underline hover:text-blue-200">← Volver</a>
    </div>

    <!-- Chat messages -->
    <div id="chat-container" class="flex-1 overflow-y-auto p-4 bg-gray-50">
        {% for msg in mensajes %}
            {% if msg.remitente == 'bot' %}
                <div class="flex justify-end mb-3">
                    <div class="bg-blue-500 text-white px-4 py-2 rounded-2xl max-w-xs shadow">
                        <p>{{ msg.texto }}</p>
                        <span class="block text-right text-xs text-blue-100 mt-1">
                            {{ msg.fecha_envio|date:"h:i A" }}
                        </span>
                    </div>
                </div>
            {% else %}
                <div class="flex justify-start mb-3">
                    <div class="bg-gray-200 text-gray-800 px-4 py-2 rounded-2xl max-w-xs shadow">
                        <p>{{ msg.texto }}</p>
                        <span class="block text-right text-xs text-gray-500 mt-1">
                            {{ msg.fecha_envio|date:"h:i A" }}
                        </span>
                    </div>
                </div>
            {% endif %}
        {% empty %}
            <p class="text-center text-gray-400 mt-6">No hay mensajes en esta conversación.</p>
        {% endfor %}
    </div>

    <!-- Input -->
    <form method="POST" class="flex items-center border-t border-gray-200 p-3 bg-white rounded-b-2xl">
        {% csrf_token %}
        {{ form.texto }}
        <button type="submit" class="ml-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
            Enviar
        </button>
    </form>
</div>

<script>
    // Auto-scroll al final del chat
    const chatContainer = document.getElementById('chat-container');
    chatContainer.scrollTop = chatContainer.scrollHeight;
</script>

{% endblock %}
